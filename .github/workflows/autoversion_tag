#!/bin/bash

current_branch=$(git rev-parse --abbrev-ref HEAD)

# Check if the current branch is QA
if [ "$current_branch" = "QA" ]; then
    # Get the latest tag in the format v.x.x.x_QA
    latest_tag=$(git describe --tags --match "v*_*_QA" --abbrev=0 2>/dev/null)
    
    # Extract the version number and increment
    if [ -z "$latest_tag" ]; then
        new_tag="v.0.0.1_QA"
    else
        version=$(echo "$latest_tag" | cut -d '_' -f 1 | cut -d '.' -f 2-)
        next_version="v.$(( ${version%.*} )).$(( ${version##*.} + 1 ))_QA"
        new_tag="$next_version"
    fi
    
    # Create the new tag
    git tag "$new_tag"
    echo "Created new tag: $new_tag"
fi
